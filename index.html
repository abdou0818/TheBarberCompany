<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>صالون الحلاقة الملكي</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="settings-icon" id="openSettings">
                    <i class="fas fa-cog"></i>
                </div>
                <div class="lang-switcher" id="langSwitcher">
                    <button class="lang-current" id="langCurrentBtn" aria-label="Language">
                        <i class="fas fa-globe"></i>
                        <span class="lang-label">ع</span>
                    </button>
                    <div class="lang-menu" id="langMenu">
                        <button type="button" data-lang="ar">عربية</button>
                        <button type="button" data-lang="fr">Français</button>
                        <button type="button" data-lang="en">English</button>
                    </div>
                </div>
                <h1 class="shop-name" data-i18n="app.title">صالون الحلاقة الملكي</h1>
                <p class="shop-subtitle" data-i18n="app.subtitle">أفضل خدمات الحلاقة والتجميل</p>
            </div>
        </header>

        <!-- Waiting Customers -->
        <section class="waiting-section">
            <div class="waiting-card">
                <h3 data-i18n="waiting.title">العملاء المنتظرون</h3>
                <div class="waiting-counter" id="waitingCounter">
                    <span id="waiting-count">0</span>
                </div>
                <p data-i18n="waiting.unit">عملاء</p>
            </div>
        </section>

        <!-- Chairs Section -->
        <section class="chairs-section">
            <h2 data-i18n="chairs.title">الكراسي</h2>
            <div class="chairs-grid" id="chairsGrid">
                <div class="chair-card" data-chair="1">
                    <div class="chair-icon"><i class="fas fa-chair"></i></div>
                    <h3>كرسي 1</h3>
                    <span class="chair-status available">متاح</span>
                </div>
                <div class="chair-card" data-chair="2">
                    <div class="chair-icon"><i class="fas fa-chair"></i></div>
                    <h3>كرسي 2</h3>
                    <span class="chair-status available">متاح</span>
                </div>
                <div class="chair-card" data-chair="3">
                    <div class="chair-icon"><i class="fas fa-chair"></i></div>
                    <h3>كرسي 3</h3>
                    <span class="chair-status available">متاح</span>
                </div>
            </div>
        </section>

        <!-- Gallery Section -->
        <section class="gallery-section">
            <h2 data-i18n="gallery.title">معرض الصور</h2>
            <div class="gallery-container" id="galleryContainer">
                <div class="no-images-message" id="noImagesMessage">
                    <i class="fas fa-images"></i>
                    <p data-i18n="gallery.no_images_title">لا توجد صور في المعرض</p>
                    <p class="sub-text" data-i18n="gallery.no_images_sub">يمكن إضافة الصور من الإعدادات</p>
                </div>
            </div>
        </section>

        <!-- Social Media -->
        <section class="social-media">
            <h2 data-i18n="social.title">وسائل التواصل الاجتماعي</h2>
            <div class="social-links">
                <a href="#" class="social-link instagram"><i class="fab fa-instagram"></i><span data-i18n="social.instagram">Instagram</span></a>
                <a href="#" class="social-link tiktok"><i class="fab fa-tiktok"></i><span data-i18n="social.tiktok">TikTok</span></a>
                <a href="tel:+966123456789" class="social-link phone"><i class="fas fa-phone"></i><span data-i18n="social.phone">الهاتف</span></a>
            </div>
        </section>

        <!-- Footer -->
        <footer class="footer">
            <p>&copy; 2024 صالون الحلاقة الملكي. <span data-i18n="footer.rights">جميع الحقوق محفوظة.</span></p>
        </footer>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content settings-content">
            <span class="close" id="closeSettings">&times;</span>
            <h2>إعدادات الموقع</h2>

            <div class="settings-section">
                <h3>إعدادات عامة</h3>
                <div class="setting-item"><label>اسم الصالون:</label><input type="text" data-setting-key="name"></div>
                <div class="setting-item"><label>الوصف:</label><input type="text" data-setting-key="subtitle"></div>
                <div class="setting-item"><label>عدد الكراسي:</label><input type="number" data-setting-key="chairCount"></div>
                <div class="setting-item"><label>الحد الأقصى للعملاء المنتظرين:</label><input type="number" data-setting-key="maxWaiting"></div>
                <div class="setting-item"><label>رابط خلفية الصفحة:</label><input type="text" data-setting-key="backgroundImage"></div>
            </div>

            <div class="settings-section">
                <h3>التواصل الاجتماعي</h3>
                <div class="setting-item"><label>Instagram:</label><input type="text" data-setting-key="instagram"></div>
                <div class="setting-item"><label>WhatsApp:</label><input type="text" data-setting-key="whatsapp"></div>
            </div>

            <div class="settings-section">
                <h3>معرض الصور</h3>
                <textarea id="galleryInput" placeholder='[{"src":"url1.jpg","alt":"صورة 1"}]'></textarea>
            </div>

            <div class="modal-buttons">
                <button id="save-settings-btn" class="confirm-btn">تطبيق التغييرات</button>
                <button id="closeSettingsBtn" class="cancel-btn">إلغاء</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="i18n.js"></script>
    <script src="script.js"></script>
    <script src="api-integration.js"></script>
    <script type="module" src="./firebase-init.js"></script>

    <!-- إعدادات ديناميكية -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            let currentSettings = {};

            const openBtn = document.getElementById('openSettings');
            const closeBtn = document.getElementById('closeSettings');
            const closeBtn2 = document.getElementById('closeSettingsBtn');
            const saveBtn = document.getElementById('save-settings-btn');
            const galleryInput = document.getElementById('galleryInput');
            const modal = document.getElementById('settingsModal');

            openBtn.addEventListener('click', () => modal.style.display = 'block');
            closeBtn.addEventListener('click', () => modal.style.display = 'none');
            closeBtn2.addEventListener('click', () => modal.style.display = 'none');
            window.addEventListener('click', e => { if(e.target==modal) modal.style.display='none'; });

            // تحميل الإعدادات المحلية إذا وجدت
            try {
                const saved = localStorage.getItem('barbershopSettings');
                if(saved) currentSettings = JSON.parse(saved);
            } catch{}

            // تطبيق جميع الإعدادات
            function applyAllSettings(settings){
                const nameEl = document.querySelector('.shop-name');
                const subtitleEl = document.querySelector('.shop-subtitle');
                if(nameEl) nameEl.textContent = settings.name||'';
                if(subtitleEl) subtitleEl.textContent = settings.subtitle||'';

                const chairs = document.querySelectorAll('.chair-card');
                chairs.forEach((card,index)=>{
                    const status = card.querySelector('.chair-status');
                    if(index< (settings.chairCount||3)){
                        card.classList.add('available'); card.classList.remove('occupied');
                        if(status){ status.textContent='متاح'; status.classList.add('available'); status.classList.remove('occupied'); }
                    }else{
                        card.classList.remove('available'); card.classList.add('occupied');
                        if(status){ status.textContent='مشغول'; status.classList.remove('available'); status.classList.add('occupied'); }
                    }
                });

                const waitingCounter = document.getElementById('waiting-count');
                if(waitingCounter) waitingCounter.textContent = settings.maxWaiting||0;

                if(settings.backgroundImage) document.body.style.backgroundImage = `url(${settings.backgroundImage})`;
                else document.body.style.backgroundImage = '';

                const socialLinks = {
                    instagram: document.querySelector('.social-link.instagram'),
                    whatsapp: document.querySelector('.social-link.phone')
                };
                for(let key in socialLinks){
                    if(socialLinks[key]){
                        if(settings[key] && settings[key].trim()!==''){
                            socialLinks[key].setAttribute('href', settings[key]);
                            socialLinks[key].style.display='flex';
                        }else socialLinks[key].style.display='none';
                    }
                }

                if(settings.gallery && Array.isArray(settings.gallery)){
                    const galleryGrid = document.getElementById('galleryContainer');
                    if(galleryGrid){
                        galleryGrid.innerHTML='';
                        settings.gallery.forEach(img=>{
                            const div = document.createElement('div');
                            div.classList.add('gallery-item');
                            div.innerHTML = `<img src="${img.src}" alt="${img.alt||''}">`;
                            galleryGrid.appendChild(div);
                        });
                    }
                }

                // حفظ محلي
                try{ localStorage.setItem('barbershopSettings', JSON.stringify(settings)); } catch{}
            }

            // ملء لوحة التحكم
            function fillInputs(settings){
                document.querySelectorAll('[data-setting-key]').forEach(input=>{
                    const key = input.dataset.settingKey;
                    if(key && settings[key]!==undefined) input.value=settings[key];
                });
                if(settings.gallery) galleryInput.value=JSON.stringify(settings.gallery,null,2);
            }

            fillInputs(currentSettings);
            applyAllSettings(currentSettings);

            document.querySelectorAll('[data-setting-key]').forEach(input=>{
                input.addEventListener('input',()=>{
                    const key = input.dataset.settingKey;
                    if(!key) return;
                    let value = input.type==='number'?parseInt(input.value)||0:input.value;
                    currentSettings[key]=value;
                    applyAllSettings(currentSettings);
                });
            });

            saveBtn.addEventListener('click',()=>{
                try{ currentSettings.gallery = JSON.parse(galleryInput.value); }catch(e){ alert('صيغة المعرض غير صحيحة'); return;}
                applyAllSettings(currentSettings);
                modal.style.display='none';
                alert('تم تطبيق جميع التغييرات للزبائن!');
            });
        });
    </script>
</body>
</html>
